python train_baseline.py
Ep 1, Step 000000, Train: 19.061, Val: 19.227, Step tok/sec: 10605, Avg tok/sec: 0
Ep 1, Step 000015, Train: 12.392, Val: 12.587, Step tok/sec: 12811, Avg tok/sec: 12811
Ep 1, Step 000030, Train: 11.561, Val: 11.785, Step tok/sec: 12627, Avg tok/sec: 12718
Ep 1, Step 000045, Train: 11.208, Val: 11.169, Step tok/sec: 12597, Avg tok/sec: 12678
Allocated memory: 2.5077 GB
Reserved memory: 22.1367 GB
Ep 2, Step 000060, Train: 10.743, Val: 10.855, Step tok/sec: 12608, Avg tok/sec: 12660
Ep 2, Step 000075, Train: 10.299, Val: 10.631, Step tok/sec: 12544, Avg tok/sec: 12637
Ep 2, Step 000090, Train: 10.117, Val: 10.514, Step tok/sec: 12570, Avg tok/sec: 12625
Allocated memory: 2.5077 GB
Reserved memory: 22.1367 GB


// optimized step 1: creating causal mask on-the-fly
python train_optimized.py
Ep 1, Step 000000, Train: 19.061, Val: 19.227, Step tok/sec: 10705, Avg tok/sec: 0
Ep 1, Step 000015, Train: 12.392, Val: 12.587, Step tok/sec: 12846, Avg tok/sec: 12846
Ep 1, Step 000030, Train: 11.561, Val: 11.785, Step tok/sec: 12886, Avg tok/sec: 12866
Ep 1, Step 000045, Train: 11.208, Val: 11.169, Step tok/sec: 12848, Avg tok/sec: 12860
Allocated memory: 2.4580 GB
Reserved memory: 22.1172 GB
Ep 2, Step 000060, Train: 10.743, Val: 10.855, Step tok/sec: 12802, Avg tok/sec: 12846
Ep 2, Step 000075, Train: 10.299, Val: 10.631, Step tok/sec: 12469, Avg tok/sec: 12769
Ep 2, Step 000090, Train: 10.117, Val: 10.514, Step tok/sec: 12677, Avg tok/sec: 12753
Allocated memory: 2.4580 GB
Reserved memory: 22.1172 GB



// optimized step 2: enable Tensor Core usage with TF32 (only on Ampere GPUs)
python train_optimized.py
Ep 1, Step 000000, Train: 19.061, Val: 19.227, Step tok/sec: 12694, Avg tok/sec: 0
Ep 1, Step 000015, Train: 12.392, Val: 12.586, Step tok/sec: 16172, Avg tok/sec: 16172
Ep 1, Step 000030, Train: 11.564, Val: 11.788, Step tok/sec: 16072, Avg tok/sec: 16122
Ep 1, Step 000045, Train: 11.210, Val: 11.171, Step tok/sec: 16120, Avg tok/sec: 16121
Allocated memory: 2.4575 GB
Reserved memory: 22.1172 GB
Ep 2, Step 000060, Train: 10.745, Val: 10.857, Step tok/sec: 16273, Avg tok/sec: 16159
Ep 2, Step 000075, Train: 10.298, Val: 10.632, Step tok/sec: 16268, Avg tok/sec: 16181
Ep 2, Step 000090, Train: 10.118, Val: 10.514, Step tok/sec: 16299, Avg tok/sec: 16200
Allocated memory: 2.4575 GB
Reserved memory: 22.1172 GB


// optimized step 3: use fused AdamW optimizer
python train_optimized.py
Ep 1, Step 000000, Train: 19.061, Val: 19.227, Step tok/sec: 12940, Avg tok/sec: 0
Ep 1, Step 000015, Train: 12.392, Val: 12.586, Step tok/sec: 16565, Avg tok/sec: 16565
Ep 1, Step 000030, Train: 11.564, Val: 11.788, Step tok/sec: 16487, Avg tok/sec: 16526
Ep 1, Step 000045, Train: 11.210, Val: 11.171, Step tok/sec: 16409, Avg tok/sec: 16487
Allocated memory: 2.4576 GB
Reserved memory: 22.1172 GB
Ep 2, Step 000060, Train: 10.745, Val: 10.857, Step tok/sec: 16367, Avg tok/sec: 16457
Ep 2, Step 000075, Train: 10.298, Val: 10.632, Step tok/sec: 16624, Avg tok/sec: 16490
Ep 2, Step 000090, Train: 10.118, Val: 10.515, Step tok/sec: 16584, Avg tok/sec: 16505
Allocated memory: 2.4576 GB
Reserved memory: 22.1172 GB

// optimized step 4: set pin_memory=TrainingArguments
python train_optimized.py
Ep 1, Step 000000, Train: 19.061, Val: 19.227, Step tok/sec: 13078, Avg tok/sec: 0
Ep 1, Step 000015, Train: 12.392, Val: 12.586, Step tok/sec: 16707, Avg tok/sec: 16707
Ep 1, Step 000030, Train: 11.564, Val: 11.788, Step tok/sec: 16611, Avg tok/sec: 16659
Ep 1, Step 000045, Train: 11.210, Val: 11.171, Step tok/sec: 16465, Avg tok/sec: 16594
Allocated memory: 2.4581 GB
Reserved memory: 22.1172 GB
Ep 2, Step 000060, Train: 10.745, Val: 10.857, Step tok/sec: 16829, Avg tok/sec: 16652
Ep 2, Step 000075, Train: 10.298, Val: 10.632, Step tok/sec: 16382, Avg tok/sec: 16597
Ep 2, Step 000090, Train: 10.118, Val: 10.515, Step tok/sec: 16509, Avg tok/sec: 16583
Allocated memory: 2.4581 GB
Reserved memory: 22.1172 GB